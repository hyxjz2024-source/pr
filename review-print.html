<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ–°åŠ å·ï½œä½æˆ¶å…¬è¨­å›å ±å ±å‘Šæ›¸ï¼ˆåˆ—å°ç‰ˆï¼‰</title>
<style>
  body {
    font-family: "Noto Sans TC", system-ui, -apple-system;
    background: #fff;
    color: #111;
    margin: 0;
    padding: 0;
  }
  .wrap {
    max-width: 960px;
    margin: 0 auto;
    padding: 40px 24px;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 3px solid #3b82f6;
    margin-bottom: 24px;
    padding-bottom: 8px;
  }
  header h1 {
    margin: 0;
    color: #1e3a8a;
    font-size: 1.5rem;
  }
  .print-btn {
    background: #3b82f6;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 0.95rem;
    box-shadow: 0 2px 6px rgba(59,130,246,0.3);
  }
  @media print {
    .print-btn { display: none; }
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 40px;
    page-break-after: always;
  }
  th, td {
    border: 1px solid #94a3b8;
    padding: 10px 12px;
    font-size: 0.95rem;
    vertical-align: top;
  }
  th {
    background: #e2e8f0;
    text-align: left;
    width: 18%;
  }
  .case-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #2563eb;
    margin-bottom: 4px;
  }
  .desc {
    white-space: pre-wrap;
    line-height: 1.6;
  }
  .images {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 8px;
  }
  .images img {
    width: 100%;
    max-width: 400px;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    object-fit: contain;
  }
  footer {
    text-align: center;
    color: #6b7280;
    font-size: 0.85rem;
    margin-top: 40px;
    border-top: 1px solid #e5e7eb;
    padding-top: 8px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>æ–°åŠ å·ç¤¾å€ï½œä½æˆ¶å…¬è¨­å›å ±å ±å‘Šæ›¸</h1>
      <button class="print-btn" onclick="window.print()">ğŸ–¨ åˆ—å°å ±å‘Š</button>
    </header>

    <div id="content">è¼‰å…¥ä¸­...</div>

    <footer>
      æ„Ÿè¬å„ä½é„°å±…çš„å”åŠ©ï¼Œä»¥ä¸Šè³‡æ–™å°‡æäº¤çµ¦é©—æ”¶å» å•†ï¼Œ<br>
      åŒæ­¥æ•´ç†æ–¼é©—æ”¶å ±å‘Šï¼Œä½œç‚ºå»ºå•†æ”¹å–„ä¾æ“šã€‚
    </footer>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";
const content = document.getElementById('content');

function extractId(url) {
  const m = url.match(/\/d\/([A-Za-z0-9_-]{10,})\//) || url.match(/id=([A-Za-z0-9_-]{10,})/);
  return m ? m[1] : null;
}

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r => r.json())
  .then(data => {
    if (!data || !data.length) {
      content.innerHTML = '<p style="color:#64748b;">ç›®å‰å°šç„¡è³‡æ–™ã€‚</p>';
      return;
    }
    content.innerHTML = data.map((it, i) => {
      const imgs = (it.images || []).map(img => {
        const id = extractId(img.viewUrl);
        return id
          ? `<img src="https://drive.google.com/uc?export=view&id=${id}" alt="æ¡ˆä»¶ç…§ç‰‡">`
          : '';
      }).join('');
      return `
        <table>
          <tr>
            <th colspan="2">
              <div class="case-title">æ¡ˆä»¶ ${i + 1}ã€€#${it.caseId || ''}</div>
            </th>
          </tr>
          <tr>
            <th>å›å ±æ™‚é–“</th><td>${it.time || ''}</td>
          </tr>
          <tr>
            <th>åœ°é»</th><td>${it.location || ''}</td>
          </tr>
          ${it.location_note ? `<tr><th>åœ°é»èªªæ˜</th><td>${it.location_note}</td></tr>` : ''}
          <tr>
            <th>å•é¡Œèªªæ˜</th><td class="desc">${(it.description || '').replace(/\n/g,'<br>')}</td>
          </tr>
          <tr>
            <th>æ¡ˆä»¶ç…§ç‰‡</th>
            <td>
              ${imgs ? `<div class="images">${imgs}</div>` : '<span style="color:#9ca3af;">ç„¡ä¸Šå‚³ç…§ç‰‡</span>'}
            </td>
          </tr>
        </table>
      `;
    }).join('');
  })
  .catch(err => {
    console.error(err);
    content.innerHTML = '<p style="color:#b91c1c;">è³‡æ–™è¼‰å…¥å¤±æ•—ã€‚</p>';
  });
</script>
</body>
</html>
