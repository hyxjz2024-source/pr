<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</title>
<style>
  /* â€”â€” è¢å¹•ï¼åˆ—å°é€šç”¨ â€”â€” */
  :root{
    --paper-w: 186mm;  /* A4(210) - å·¦å³ 12mm é‚Šç•Œ = 186mm å¯å°å¯¬ */
    --font: "Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang TC", "Microsoft JhengHei";
  }
  * { box-sizing:border-box }
  html,body{ margin:0; padding:0; background:#fff; color:#000; font-family:var(--font) }

  .paper{
    width: var(--paper-w);
    margin: 10mm auto;         /* è¢å¹•é è¦½ç½®ä¸­ */
  }

  .toolbar{
    width: var(--paper-w);
    margin: 6mm auto 0;
    text-align: right;
  }
  .toolbar button{
    padding:8px 12px; border:1px solid #ccc; background:#f7f7f7; cursor:pointer; border-radius:6px;
  }

  h1{
    font-size: 18px;
    text-align: center;
    margin: 0 0 6mm;
    border-bottom: 2px solid #000;
    padding-bottom: 3mm;
  }

  table{
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;     /* é˜²æ­¢åˆ—å°æ›é æ™‚æ’å¯¬ */
    font-size: 12px;
  }
  th,td{
    border:1px solid #000;
    padding: 4px 6px;
    vertical-align: top;
    word-wrap: break-word;
    overflow-wrap: anywhere;
    text-align: center;
  }
  th{ background:#f7f7f7; font-weight:700 }

  /* âœ… æ¬„å¯¬æ¯”ä¾‹ï¼ˆç¸½å’Œ 100%ï¼‰ */
  col.c-no     { width: 4%  }   /* é …æ¬¡ */
  col.c-dev    { width: 4%  }   /* è¨­å‚™åç¨± */
  col.c-loc    { width: 11% }   /* æ¨“å±¤ä½ç½® */
  col.c-desc   { width: 25% }   /* ç¼ºå¤±èªªæ˜ */
  col.c-cat    { width: 3%  }   /* ç´šåˆ¥ */
  col.c-photo  { width: 33% }   /* ç¼ºå¤±ç…§ç‰‡ */
  col.c-prog   { width: 14% }   /* æ”¹å–„æƒ…æ³ */
  col.c-note   { width: 6% }    /* æ”¹å–„èªªæ˜ */

  td.loc{ text-align:left; line-height:1.5 }
  td.desc{ text-align:left; line-height:1.55 }
  .loc-note{ color:#555; font-size: 11px }

  .photo img{
    display:block;
    width:100%;
    height:auto;             /* åˆ—å°æ™‚ä¾å¯¬è‡ªé©æ‡‰ï¼Œä¸æœƒæº¢å‡º */
    margin: 3px auto;
    border:1px solid #ccc;
  }

  .footer{
    text-align:center; color:#555; font-size:11px; margin-top:6mm;
  }

  /* â€”â€” åˆ—å°è¨­å®š â€”â€” */
  @media print{
    @page{
      size: A4 portrait;      /* ç›´å¼ A4 */
      margin: 12mm;           /* å·¦å³ 12mmï¼Œä¸Šä¸‹ 12mm */
    }
    .toolbar{ display:none !important; }
    html,body{ margin:0; padding:0 }
    .paper{ width: var(--paper-w); margin:0 auto }   /* ç½®ä¸­ä¸”ä¸è¶…é å¯¬ */
    table{ font-size: 11px }
    th,td{ padding: 3px 5px }
    .photo img{ border-color:#bbb }
    tr, td{ break-inside: avoid; page-break-inside: avoid } /* ç›¡é‡é¿å…åˆ—è¢«æ‹†é–‹ */
  }
</style>
</head>
<body>

<div class="toolbar no-print">
  <button onclick="window.print()">ğŸ–¨ åˆ—å°å ±å‘Š</button>
</div>

<div class="paper">
  <h1>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</h1>

  <table>
    <colgroup>
      <col class="c-no">
      <col class="c-dev">
      <col class="c-loc">
      <col class="c-desc">
      <col class="c-cat">
      <col class="c-photo">
      <col class="c-prog">
      <col class="c-note">
    </colgroup>
    <thead>
      <tr>
        <th>é …æ¬¡</th>
        <th>è¨­å‚™åç¨±</th>
        <th>æ¨“å±¤ä½ç½®</th>
        <th>ç¼ºå¤±èªªæ˜</th>
        <th>ç´šåˆ¥</th>
        <th>ç¼ºå¤±ç…§ç‰‡</th>
        <th>æ”¹å–„æƒ…æ³</th>
        <th>æ”¹å–„èªªæ˜</th>
      </tr>
    </thead>
    <tbody id="reportBody">
      <tr><td colspan="8">è³‡æ–™è¼‰å…¥ä¸­â€¦</td></tr>
    </tbody>
  </table>

  <div class="footer">
    æ„Ÿè¬å„ä½é„°å±…çš„å”åŠ©ï¼Œä»¥ä¸Šè³‡æ–™å°‡æäº¤çµ¦é©—æ”¶å» å•†ï¼Œä¸¦æ•´ç†æ–¼å ±å‘Šæ›¸ä¾›å»ºå•†æ”¹å–„ã€‚
  </div>
</div>

<script>
/* ä½ çš„ GAS å…¬é–‹ API */
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";

const tbody = document.getElementById('reportBody');
const esc = s => s ? String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])) : '';

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r=>r.json())
  .then(list=>{
    if(!list || !list.length){
      tbody.innerHTML = '<tr><td colspan="8">ç›®å‰æ²’æœ‰è³‡æ–™</td></tr>';
      return;
    }

    tbody.innerHTML = list.map((it, i)=>{
      const locMain = esc(it.location || '');
      const locNote = it.location_note ? `<br><span class="loc-note">ï¼ˆ${esc(it.location_note)}ï¼‰</span>` : '';
      const imgs = (it.images || []).map(img=>{
        const src = img.thumbUrl || img.viewUrl || img.fileUrl || '';
        return src ? `<img src="${src}" alt="æ¡ˆä»¶ç…§ç‰‡" loading="lazy">` : '';
      }).join('');

      return `
        <tr>
          <td>${i+1}</td>
          <td>å…¶ä»–</td>
          <td class="loc">${locMain}${locNote}</td>
          <td class="desc">${esc(it.description || '').replace(/\n/g,'<br>')}</td>
          <td></td> <!-- ç´šåˆ¥ï¼šç©ºç™½ -->
          <td class="photo">${imgs || 'â€”'}</td>
          <td></td>
          <td></td>
        </tr>
      `;
    }).join('');
  })
  .catch(err=>{
    console.error(err);
    tbody.innerHTML = '<tr><td colspan="8">è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>';
  });
</script>
</body>
</html>

