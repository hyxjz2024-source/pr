<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</title>
<style>
  body {
    font-family: "Noto Sans TC", system-ui, -apple-system;
    margin: 0;
    background: #fff;
    color: #000;
  }
  .wrap {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  h1 {
    text-align: center;
    font-size: 1.4rem;
    margin-bottom: 10px;
    border-bottom: 2px solid #000;
    padding-bottom: 6px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    table-layout: fixed;
    margin-top: 10px;
    page-break-after: always;
  }
  th, td {
    border: 1px solid #000;
    padding: 6px 4px;
    font-size: 0.9rem;
    vertical-align: top;
    text-align: center;
    word-break: break-all;
  }
  th {
    background: #f8f8f8;
    font-weight: 700;
  }
  td.desc {
    text-align: left;
  }
  td img {
    width: 100%;
    max-width: 240px;
    height: auto;
    margin: 4px auto;
    display: block;
    border: 1px solid #ccc;
  }
  @media print {
    .no-print { display: none; }
    body { -webkit-print-color-adjust: exact; }
    @page { size: A4 landscape; margin: 15mm; }
  }
  .footer {
    text-align: center;
    font-size: 0.85rem;
    color: #555;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</h1>
    <button class="no-print" onclick="window.print()" style="float:right;margin-bottom:10px;">ğŸ–¨ åˆ—å°å ±å‘Š</button>
    <table id="reportTable">
      <thead>
        <tr>
          <th>é …æ¬¡</th>
          <th>è¨­å‚™åç¨±</th>
          <th>æ¨“å±¤ä½ç½®</th>
          <th>ç¼ºå¤±èªªæ˜</th>
          <th>é¡åˆ¥</th>
          <th>ç¼ºå¤±ç…§ç‰‡</th>
          <th>æ”¹å–„æƒ…æ³</th>
          <th>æ”¹å–„èªªæ˜</th>
        </tr>
      </thead>
      <tbody id="reportBody">
        <tr><td colspan="8">è³‡æ–™è¼‰å…¥ä¸­â€¦</td></tr>
      </tbody>
    </table>
    <div class="footer">
      æ„Ÿè¬å„ä½é„°å±…å”åŠ©æä¾›å›å ±è³‡æ–™ï¼Œä»¥ä¸Šç¼ºå¤±å°‡å½™æ•´æäº¤é©—æ”¶å» å•†èˆ‡å»ºå•†æ”¹å–„ã€‚
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";
const tbody = document.getElementById('reportBody');

function extractId(url) {
  const m = url.match(/\/d\/([A-Za-z0-9_-]{10,})\//) || url.match(/id=([A-Za-z0-9_-]{10,})/);
  return m ? m[1] : null;
}

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r => r.json())
  .then(data => {
    if (!data || !data.length) {
      tbody.innerHTML = '<tr><td colspan="8">ç›®å‰ç„¡è³‡æ–™</td></tr>';
      return;
    }

    tbody.innerHTML = data.map((it, i) => {
      const imgs = (it.images || []).map(img => {
        const id = extractId(img.viewUrl);
        return id
          ? `<img src="https://drive.google.com/uc?export=view&id=${id}" alt="æ¡ˆä»¶ç…§ç‰‡">`
          : '';
      }).join('');

      return `
        <tr>
          <td>${i + 1}</td>
          <td>å…¶ä»–</td>
          <td>${it.location || ''}</td>
          <td class="desc">${(it.description || '').replace(/\n/g, '<br>')}</td>
          <td>${it.location_note || ''}</td>
          <td>${imgs || 'â€”'}</td>
          <td></td>
          <td></td>
        </tr>
      `;
    }).join('');
  })
  .catch(err => {
    console.error(err);
    tbody.innerHTML = '<tr><td colspan="8">è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>';
  });
</script>
</body>
</html>
