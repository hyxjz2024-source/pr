<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</title>
<style>
  :root{
    --page-margin: 8mm;                /* åˆ—å°é‚Šè·ï¼ˆå·¦å³å„ 8mmï¼‰ */
    --printable-width: calc(210mm - 2 * var(--page-margin));
  }

  /* --- è¢å¹•ç‰ˆé¢ --- */
  body{
    font-family:"Noto Sans TC",system-ui,-apple-system;
    background:#fff; color:#000; margin:0; padding:20px;
  }
  .page{ max-width:1100px; margin:0 auto; }
  h1{ text-align:center; font-size:1.4rem; border-bottom:2px solid #000; padding-bottom:6px; margin:0 0 12px }
  .no-print{ border:0; background:#e5e7eb; padding:6px 10px; border-radius:6px; cursor:pointer }
  .no-print:active{ transform:translateY(1px) }

  table{ border-collapse:collapse; width:100%; table-layout:fixed }
  col.col-no{ width:44px }
  col.col-dev{ width:86px }
  col.col-loc{ width:150px }
  col.col-desc{ width:280px }
  col.col-cat{ width:86px }
  col.col-photo{ width:320px }
  col.col-prog{ width:120px }
  col.col-note{ width:160px }

  th,td{ border:1px solid #000; font-size:.9rem; padding:6px; vertical-align:top; text-align:center; word-break:break-word }
  th{ background:#f8f8f8; font-weight:700 }
  td.desc{ text-align:left; line-height:1.55 }
  td.loc{ text-align:left; line-height:1.5 }
  .loc-note{ color:#555; font-size:.88em }
  .photo img{ width:100%; max-width:300px; height:auto; display:block; margin:4px auto; border:1px solid #ccc }
  .footer{ text-align:center; font-size:.85rem; color:#555; margin-top:12px }

  /* --- åˆ—å°ç‰ˆé¢ï¼ˆç½®ä¸­ + æ¬„å¯¬ + ç¸®æ”¾ï¼‰ --- */
  @media print{
    @page{ size: A4 portrait; margin: var(--page-margin); }

    /* è®“æ•´é ç½®ä¸­ */
    html, body{ background:#fff !important; }
    body{
      display:flex; justify-content:center; align-items:flex-start;
      -webkit-print-color-adjust: exact; print-color-adjust: exact;
    }
    .page{
      width: var(--printable-width);   /* å¯åˆ—å°å¯¬åº¦ï¼Œè®“è¡¨æ ¼å‰›å¥½è½åœ¨å¯åˆ—å°å€ */
      margin: 0 auto;
      zoom: 0.86;                      /* å¾®ç¸®ä»¥ç¢ºä¿å³æ¬„ä¸æˆªæ‰ï¼Œå¿…è¦æ™‚å¾®èª¿ 0.82~0.90 */
    }

    table{ width:100%; table-layout:fixed; font-size:0.82rem; }
    th,td{ padding:4px 6px; }

    /* åˆ—å°å°ˆç”¨æ¬„å¯¬ï¼ˆmm å–®ä½æ›´ç©©å®šï¼‰ */
    col.col-no   { width: 12mm; }
    col.col-dev  { width: 20mm; }
    col.col-loc  { width: 26mm; }
    col.col-desc { width: 56mm; }
    col.col-cat  { width: 20mm; }
    col.col-photo{ width: 38mm; }
    col.col-prog { width: 22mm; }
    col.col-note { width: 22mm; }

    .photo img{ max-width:120px; height:auto; }
    tr, td{ break-inside: avoid; page-break-inside: avoid; }

    .no-print{ display:none !important; }
  }

  /* è‹¥æ‰‹å‹•æ”¹ç‚ºæ©«å¼ï¼Œå–æ¶ˆç¸®æ”¾é¿å…éå° */
  @media print and (orientation:landscape){
    .page{ zoom:1; }
  }
</style>
</head>
<body>
  <div class="page">
    <h1>æ–°åŠ å·ç¤¾å€å§”å“¡æœƒæåˆ—äº‹é …ç¼ºå¤±ç…§ç‰‡</h1>
    <button class="no-print" onclick="window.print()" style="float:right;margin-bottom:10px">ğŸ–¨ åˆ—å°å ±å‘Š</button>

    <table>
      <colgroup>
        <col class="col-no">
        <col class="col-dev">
        <col class="col-loc">
        <col class="col-desc">
        <col class="col-cat">
        <col class="col-photo">
        <col class="col-prog">
        <col class="col-note">
      </colgroup>
      <thead>
        <tr>
          <th>é …æ¬¡</th>
          <th>è¨­å‚™åç¨±</th>
          <th>æ¨“å±¤ä½ç½®</th>
          <th>ç¼ºå¤±èªªæ˜</th>
          <th>é¡åˆ¥</th>
          <th>ç¼ºå¤±ç…§ç‰‡</th>
          <th>æ”¹å–„æƒ…æ³</th>
          <th>æ”¹å–„èªªæ˜</th>
        </tr>
      </thead>
      <tbody id="reportBody">
        <tr><td colspan="8">è³‡æ–™è¼‰å…¥ä¸­â€¦</td></tr>
      </tbody>
    </table>

    <div class="footer">
      æ„Ÿè¬å„ä½é„°å±…çš„å”åŠ©ï¼Œä»¥ä¸Šè³‡æ–™å°‡æäº¤çµ¦é©—æ”¶å» å•†ï¼Œä¸¦æ•´ç†æ–¼å ±å‘Šæ›¸ä¾›å»ºå•†æ”¹å–„ã€‚
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";
const tbody = document.getElementById('reportBody');
const esc = s => s ? String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])) : '';

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r=>r.json())
  .then(list=>{
    if(!list || !list.length){
      tbody.innerHTML = '<tr><td colspan="8">ç›®å‰æ²’æœ‰è³‡æ–™</td></tr>';
      return;
    }

    tbody.innerHTML = list.map((it, i)=>{
      const locMain = esc(it.location || '');
      const locNote = it.location_note ? `<br><span class="loc-note">ï¼ˆ${esc(it.location_note)}ï¼‰</span>` : '';
      const locCell = `${locMain}${locNote}`;

      const imgs = (it.images || [])
        .map(img => {
          const src = img.thumbUrl || img.viewUrl || img.fileUrl || '';
          return src ? `<img src="${src}" alt="æ¡ˆä»¶ç…§ç‰‡" loading="lazy">` : '';
        })
        .join('');

      return `
        <tr>
          <td>${i+1}</td>
          <td>å…¶ä»–</td>
          <td class="loc">${locCell}</td>
          <td class="desc">${esc(it.description || '').replace(/\n/g,'<br>')}</td>
          <td>å…¶ä»–</td>
          <td class="photo">${imgs || 'â€”'}</td>
          <td></td>
          <td></td>
        </tr>
      `;
    }).join('');
  })
  .catch(err=>{
    console.error(err);
    tbody.innerHTML = '<tr><td colspan="8">è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>';
  });
</script>
</body>
</html>
