<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>新加州｜10/24 公設總驗收報名</title>
  <meta name="description" content="公設總驗收分組說明與住戶報名（GitHub+GAS）" />
  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --brand:#0ea5e9; --ok:#16a34a; --err:#dc2626; --bg:#f8fafc; --card:#ffffff; --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:"Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:var(--ink); background:var(--bg);}    
    .wrap{max-width:min(1080px,100% - 24px); margin:24px auto;}
    header{display:grid; gap:10px; margin-bottom:20px}
    .hero{background:linear-gradient(135deg,#e0f2fe,#fff); padding:20px; border-radius:var(--radius); box-shadow:0 6px 18px rgba(15,23,42,.06)}
    h1{margin:0 0 6px; font-size:clamp(22px,3.2vw,32px);color: #14178A}
    .meta{color:var(--muted); font-size:14px}

    .grid{display:grid; gap:14px}
    @media (min-width:900px){ .grid{grid-template-columns: 1fr 360px;} }

    .card{background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:0 6px 18px rgba(15,23,42,.06)}
    .list{display:grid; gap:10px}
    .item{border:1px solid #e5e7eb; border-radius:14px; padding:12px}
    .item h3{margin:0 0 6px; font-size:18px}
    .item p{margin:0; color:var(--muted); font-size:14px}

    form{display:grid; gap:10px}
    label{font-weight:600}
    input,select,button,textarea{width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:12px; font:inherit}
    textarea{min-height:90px}
    button{background:var(--brand); color:#fff; border:none; cursor:pointer; font-weight:700}
    button[disabled]{opacity:.6; cursor:not-allowed}

    .toast{position:fixed; inset:auto 16px 16px auto; background:#fff; border:1px solid #e5e7eb; box-shadow:0 6px 20px rgba(15,23,42,.12); padding:10px 12px; border-radius:12px; display:none}
    .toast.ok{border-color:#bbf7d0}
    .toast.err{border-color:#fecaca}
    .hint{font-size:12px; color:var(--muted)}
    .req{color:#ef4444}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <h1>新加州｜10/24 公設總驗收</h1>
      <h2>分組說明＋住戶報名</h2>
      <div class="meta">📅 時間：10/24（五）09:00–17:00｜全區公設驗收（除電梯外）</div>
      <div class="meta">📍 集合地點：社區大廳</div>
      <div class="meta">👥 參加人員：管委會／住戶 × 建商／廠商 × 國霖機電</div>
      <div class="meta" style="margin-top:6px; color:#334155;">
        💡 住戶可全程參與，中途若有事可自由離開，不影響流程。<br>
        歡迎大家依自身時間彈性參加，一起了解社區各項設備運作。
      </div>
    </header>

    <div class="grid">
      <!-- 左側：說明清單 -->
      <section class="card">
        <h2 style="margin-top:0">分組與說明</h2>
        <div class="list" id="groupList"></div>
      </section>

      <!-- 右側：報名表單 -->
      <aside class="card">
        <h2 style="margin-top:0">我要報名</h2>
        <form id="signupForm" novalidate>
          <div>
            <label>姓名 <span class="req">*</span></label>
            <input name="name" required placeholder="例：王小明" />
          </div>
          <div>
            <label>棟別／樓層 <span class="req">*</span></label>
            <input name="unit" required placeholder="例：C 棟 12F" />
          </div>
          <div>
            <label>聯絡手機 <span class="req">*</span></label>
            <input name="phone" required inputmode="numeric" placeholder="09xx-xxx-xxx" />
          </div>
          <div>
            <label>報名組別 <span class="req">*</span></label>
            <select name="group" required id="groupSelect"></select>
          </div>
          <div>
            <label>可參與時段</label>
            <select name="slot">
              <option value="全程(09:00–17:00)">全程(09:00–17:00)</option>
              <option value="上午(09:00–11:30)">上午(09:00–11:30)</option>
              <option value="下午(13:00–17:00)">下午(13:00–17:00)</option>
            </select>
          </div>
          <div>
            <label>備註（選填）</label>
            <textarea name="note" placeholder="想與哪位鄰居同組、或有專長可協助等"></textarea>
          </div>

          <button id="submitBtn" type="submit">送出報名</button>
          <div class="hint">報名資料僅用於本次驗收之現場安排與紀錄。</div>
        </form>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // === 1) 組別資料 ===
    const GROUPS = [
      {id:1, name:"全區導覽組", desc:"由驗收專員帶領巡視各項檢驗區域與方式，進行流程與重點說明導覽，不參與實際驗測。"},
      {id:2, name:"電氣組", desc:"陪同檢測配電盤、電表、迴路、接地測試與電壓電流安全性。"},
      {id:3, name:"發電機組", desc:"陪同模擬停電、ATS切換、備援供電與警報功能測試。"},
      {id:4, name:"消防電組", desc:"陪同檢查消防控制盤、警報設備電氣連動測試。"},
      {id:5, name:"消防水組", desc:"陪同測試消防泵浦供水、放水、壓力與泡沫測試及連動。"},
      {id:6, name:"給排水組", desc:"陪同檢查供水、排水、抽水機與集水井等動靜態測試。"},
      {id:7, name:"弱電組", desc:"陪同檢查門禁、對講、監控、網路與機房設備。"},
      {id:8, name:"通風空調組", desc:"陪同檢查地下室通風與導流風機運轉、風量與異音。"},
      {id:9, name:"土建組", desc:"陪同檢查結構外觀、牆面、地坪、門框及公共區域缺失。"}
    ];

    const list = document.getElementById('groupList');
    const select = document.getElementById('groupSelect');
    GROUPS.forEach(g => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<h3>${g.id}. ${g.name}</h3><p>${g.desc}</p>`;
      list.appendChild(div);

      const opt = document.createElement('option');
      opt.value = `${g.id}. ${g.name}`;
      opt.textContent = `${g.id}. ${g.name}`;
      select.appendChild(opt);
    });

    // === 2) 提示 ===
    const toast = (msg, ok=false) => {
      const el = document.getElementById('toast');
      el.textContent = msg; el.className = `toast ${ok? 'ok':'err'}`; el.style.display = 'block';
      setTimeout(()=>{ el.style.display='none'; }, 3600);
    };

    // === 3) 送出表單（text/plain） ===
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby26Pv-rQbQ6FDAt3ivxhCj-3jRS70hzfXyoZ1PsVvDamU45PK8EHrwSyhtRhK3HSxs/exec';

    const form = document.getElementById('signupForm');
    const btn  = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!form.reportValidity()) return;

      const data = Object.fromEntries(new FormData(form).entries());
      data._ts = new Date().toISOString();

      btn.disabled = true; btn.textContent = '傳送中…';
      try{
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action:'signup', payload: data })
        });
        const text = await res.text();
        const json = JSON.parse(text);

        if(json?.ok){
          toast('報名成功，感謝參與！', true);
          form.reset();
        }else{
          throw new Error(json?.message || '發生未知錯誤');
        }
      }catch(err){
        console.error(err);
        toast('送出失敗：' + err.message);
      }finally{
        btn.disabled = false; btn.textContent = '送出報名';
      }
    });
  </script>
</body>
</html>
