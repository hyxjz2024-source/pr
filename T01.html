<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>新加州｜缺失照片橫向排版</title>
<style>
  body {
    font-family: "Noto Sans TC", system-ui, -apple-system;
    background: #fff;
    color: #111;
    margin: 0;
  }
  .wrap {
    max-width: 95%;
    margin: 20px auto;
  }
  h1 {
    text-align: center;
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 16px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    border: 2px solid #000;
  }
  th, td {
    border: 1px solid #000;
    padding: 6px;
    text-align: center;
    font-size: 14px;
    vertical-align: top;
  }
  th {
    background: #f5f5f5;
    font-weight: bold;
  }

  /* ✅ 圖片橫向排列 + 自動換行 + 不出現捲軸 */
  .photo {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 10px;
  }
  .photo img {
    height: 130px;
    width: auto;
    border: 1px solid #000;
    border-radius: 4px;
    object-fit: cover;
  }

  @media (max-width: 768px){
    .photo img { height: 90px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>新加州｜缺失照片一覽</h1>
    <table>
      <thead>
        <tr>
          <th style="width:10%;">項次</th>
          <th>缺失照片</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="2">資料載入中…</td></tr>
      </tbody>
    </table>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";
const tbody = document.getElementById("tbody");

function esc(s){ return s ? String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])) : ''; }

function render(rows){
  if(!rows || !rows.length){
    tbody.innerHTML = '<tr><td colspan="2">目前沒有資料</td></tr>';
    return;
  }

  tbody.innerHTML = rows.map((it, i)=>{
    const imgs = (it.images || []).map(img=>{
      const src = img.thumbUrl || img.viewUrl || img.fileUrl || '';
      const href = img.viewUrl || src;
      return src ? `<a href="${href}" target="_blank"><img src="${src}" alt="缺失照片"></a>` : '';
    }).join('');

    return `
      <tr>
        <td>${i+1}</td>
        <td class="photo">${imgs || '—'}</td>
      </tr>`;
  }).join('');
}

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r=>r.json())
  .then(render)
  .catch(e=>{
    console.error(e);
    tbody.innerHTML = '<tr><td colspan="2">載入失敗</td></tr>';
  });
</script>
</body>
</html>
