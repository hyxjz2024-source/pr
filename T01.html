<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>新加州｜公設回報（橫向完整圖版）</title>
<style>
  body {
    font-family: "Noto Sans TC", system-ui, -apple-system;
    background: #fff;
    margin: 0;
    color: #111;
  }
  .wrap {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 10px;
  }
  h1 {
    text-align: center;
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 16px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    border: 2px solid #000;
  }
  th, td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 14px;
    vertical-align: top;
    word-wrap: break-word;
  }
  th {
    background: #f5f5f5;
    text-align: center;
  }
  .desc, .loc {
    text-align: left;
    line-height: 1.5;
  }
  .photo {
    text-align: left;
  }
  /* ✅ 圖片全橫向顯示（不出現捲軸） */
  .photo img {
    display: inline-block;
    height: 120px;
    width: auto;
    margin-right: 8px;
    border: 1px solid #000;
    border-radius: 4px;
    object-fit: cover;
    vertical-align: middle;
  }
  @media (max-width: 768px) {
    th, td { font-size: 13px; }
    .photo img { height: 90px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>新加州｜公設回報（橫向完整圖版）</h1>
    <table>
      <thead>
        <tr>
          <th>項次</th>
          <th>設備名稱</th>
          <th>樓層位置</th>
          <th>缺失說明</th>
          <th>級別</th>
          <th>缺失照片</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="6" style="text-align:center;">資料載入中…</td></tr>
      </tbody>
    </table>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEuG_5s5RhDD5fHPafkkneTb4lEkgah7xTS1Y_A3HBK468aAM89GxfDxZPWQn310Lq/exec";
const tbody = document.getElementById("tbody");
const esc = s => s ? String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])) : '';

function render(rows){
  if(!rows || !rows.length){
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">目前沒有資料</td></tr>';
    return;
  }
  tbody.innerHTML = rows.map((it, idx)=>{
    const loc = esc(it.location || '') + (it.location_note ? `<br><small>（${esc(it.location_note)}）</small>` : '');
    const desc = esc(it.description || '').replace(/\n/g, "<br>");
    const imgs = (it.images || []).map(img=>{
      const src = img.thumbUrl || img.viewUrl || img.fileUrl || '';
      const href = img.viewUrl || src;
      return src ? `<a href="${href}" target="_blank"><img src="${src}" alt="缺失照片"></a>` : '';
    }).join('');
    return `
      <tr>
        <td style="text-align:center;">${idx+1}</td>
        <td style="text-align:center;">其他</td>
        <td class="loc">${loc}</td>
        <td class="desc">${desc}</td>
        <td style="text-align:center;">其他</td>
        <td class="photo">${imgs || '—'}</td>
      </tr>`;
  }).join('');
}

fetch(`${API_URL}?api=public&limit=500&_=${Date.now()}`)
  .then(r=>r.json())
  .then(render)
  .catch(e=>{
    console.error(e);
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">載入失敗</td></tr>';
  });
</script>
</body>
</html>
